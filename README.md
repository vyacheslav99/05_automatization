# 05 automatization
Урок 05 Асинхронный http-сервер

## Описание ПО
При разработке сервера реализована архитектура thread pool.

### Особенности архитектуры
При старте сервер сразу создает пул подготовленных к работе потоков-обработчиков (thread, workers).
Количество обработчиков в пуле задается параметром в конфиге INIT_HANDLERS или параметром командной строки -w.
Данное кол-во потоков все время содержится в пуле подготовленным к работе.
Если при поступлении нового соединения все обработчики в пуле заняты обработкой соединения, создается новый обработчик и добавляется в пул.
Т.о. пул расширяется по ходу работы сервера. Если начальный размер пула задан числом меньше 1, то пул создается пустой, но при
поступлении соединений так же в него добавляются новые обработчики. Пул может быть расширен до размера, указанного параметром MAX_HANDLERS.
Все новые соединения, когда все потоки в пуле заняты и его размер равен максимальному, будут сбрасываться сервером, пока не освободится
какой-нибудь обработчик или не уменьшиться размер пула.
Предусмотрен механизм очистки пула. При очистке из пула будут удаляться все свободные обработчики, пока его размер не станет равен начальному
(задаваемому параметром INIT_HANDLERS). Настройки стратегии очистки доступны в конфиге.

## Результаты тестирования
Все тесты, кроме одного проходят успешно.
В связи с особенностью реализации не проходит тест "directory index file absent".
Дело в том, что я немного отступил от Т.З. и реализовал такую логику - если запрос на папку, а не на файл, то по условиям задачи надо вернуть
index.html из этой папки. Эта часть так и работает, но если в папке нет такого файла, я сделал генерацию стандартного файла index.html,
содержащего список папок/файлов указанной папки. Я это сделал для удобства отладки сервера на время разработки, но потом решил оставить это поведение.

## Результаты нагрузочного тестирования
Completed 5000 requests


Server Software:        MyServer/1.0.0
Server Hostname:        localhost
Server Port:            8080

Document Path:          /dir2
Document Length:        0 bytes

Concurrency Level:      100
Time taken for tests:   624.717 seconds
Complete requests:      7199
Failed requests:        7042
   (Connect: 0, Receive: 1045, Length: 5997, Exceptions: 0)
Write errors:           0
Total transferred:      1034924 bytes
HTML transferred:       204578 bytes
Requests per second:    11.52 [#/sec] (mean)
Time per request:       8677.826 [ms] (mean)
Time per request:       86.778 [ms] (mean, across all concurrent requests)
Transfer rate:          1.62 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0   86 191.8      0     519
Processing:  2063 8479 1029.1   8766    9798
Waiting:        0 5475 2670.9   6188    8766
Total:       2063 8565 1052.1   8766    9802

Percentage of the requests served within a certain time (ms)
  50%   8766
  66%   8773
  75%   9282
  80%   9282
  90%   9282
  95%   9282
  98%   9797
  99%   9797
 100%   9802 (longest request)

Test aborted after 10 failures

apr_socket_connect(): ╤фхырэр яюя√Єър т√яюыэшЄ№ юяхЁрЎш■ эр юс·хъЄх, эх  ты ■∙хьё  ёюъхЄюь.   (730038)
Total of 7199 requests completed
